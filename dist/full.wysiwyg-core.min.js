/** v1.0.2 **/ !function(t){function e(e){var a=e.handler,n=(e.namespace||"").toLowerCase().split(" ");n=t.map(n,function(t){return t.split(".")}),(1!==n.length||""!==n[0]&&"autocomplete"!==n[0].substring(0,12)&&"accordion"!==n[0].substring(0,9)&&"tabs"!==n[0].substring(0,4)&&"menu"!==n[0].substring(0,4))&&(e.handler=function(e){if(this===e.target||!/textarea|select/i.test(e.target.nodeName)&&"text"!==e.target.type&&"true"!=$(e.target).prop("contenteditable")){var o="keypress"!==e.type&&t.hotkeys.specialKeys[e.which],i=String.fromCharCode(e.which).toLowerCase(),r="",s={};e.altKey&&"alt"!==o&&(r+="alt_"),e.ctrlKey&&"ctrl"!==o&&(r+="ctrl_"),e.metaKey&&!e.ctrlKey&&"meta"!==o&&(r+="meta_"),e.shiftKey&&"shift"!==o&&(r+="shift_"),o?s[r+o]=!0:(s[r+i]=!0,s[r+t.hotkeys.shiftNums[i]]=!0,"shift_"===r&&(s[t.hotkeys.shiftNums[i]]=!0));for(var l=0,c=n.length;c>l;l++)if(s[n[l]])return a.apply(this,arguments)}})}t.hotkeys={version:"0.8+",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",188:",",190:".",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},t.each(["keydown","keyup","keypress"],function(){t.event.special[this]={add:e}})}(jQuery),function(t){"use strict";var e=function(t,e){var a,n,o,i,r=0,s=function(){r=new Date,o=null,i=t.apply(a,n)};return function(){var l=new Date,c=e-(l-r);return a=this,n=arguments,0>=c?(clearTimeout(o),o=null,r=l,i=t.apply(a,n)):o||(o=setTimeout(s,c)),i}},a=function(e){var a=t.Deferred(),n=new FileReader;return n.onload=function(t){a.resolve(t.target.result)},n.onerror=a.reject,n.onprogress=a.notify,n.readAsDataURL(e),a.promise()};t.fn.cleanHtml=function(e){if(t(this).data("wysiwyg-html-mode")===!0&&(t(this).html(t(this).text()),t(this).attr("contenteditable",!0),t(this).data("wysiwyg-html-mode",!1)),e===!0&&t(this).parent().is("form")){var a=t(this).html;if(t(a).has("img").length){var n=t("img",t(a)),o=[],i=t(this).parent();t.each(n,function(e,a){t(a).attr("src").match(/^data:image\/.*$/)&&(o.push(n[e]),t(i).prepend("<input value='"+t(a).attr("src")+"' type='hidden' name='postedimage/"+e+"' />"),t(a).attr("src","postedimage/"+e))})}}var r=t(this).html();return r&&r.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")},t.fn.wysiwyg=function(n){var o,i,r,s=this,l=t(s).parent(),c=function(){i.activeToolbarClass&&t(i.toolbarSelector,l).find(r).each(e(function(){var e=t(this).data(i.commandRole).split(" "),a=e[0];e.length>1&&document.queryCommandEnabled(a)&&document.queryCommandValue(a)==e[1]?t(this).addClass(i.activeToolbarClass):1===e.length&&document.queryCommandEnabled(a)&&document.queryCommandState(a)?t(this).addClass(i.activeToolbarClass):t(this).removeClass(i.activeToolbarClass)},i.keypressTimeout))},d=function(t,e){var a=t.split(" "),n=a.shift(),o=a.join(" ")+(e||""),i=t.split("-");1==i.length?document.execCommand(n,0,o):"format"==i[0]&&2==i.length&&document.execCommand("formatBlock",!1,i[1]),c()},u=function(e){t.each(e,function(t,e){s.keydown(t,function(t){s.attr("contenteditable")&&s.is(":visible")&&(t.preventDefault(),t.stopPropagation(),d(e))}).keyup(t,function(t){s.attr("contenteditable")&&s.is(":visible")&&(t.preventDefault(),t.stopPropagation())})})},f=function(){var t,e;return window.getSelection?(t=window.getSelection(),t.getRangeAt&&t.rangeCount&&(e=t.getRangeAt(0))):document.selection&&(e=document.selection.createRange()),e},h=function(){o=f()},m=function(){var t;if(window.getSelection||document.createRange){if(t=window.getSelection(),o){try{t.removeAllRanges()}catch(e){document.body.createTextRange().select(),document.selection.empty()}t.addRange(o)}}else document.selection&&o&&o.select()},p=function(){if(t(s).data("wysiwyg-html-mode")!==!0){var e=t(s).html(),a=t("<pre />");t(a).append(document.createTextNode(e)),t(a).attr("contenteditable",!0),t(s).html(" "),t(s).append(t(a)),t(s).attr("contenteditable",!1),t(s).data("wysiwyg-html-mode",!0),t(a).focus()}else t(s).html(t(s).text()),t(s).attr("contenteditable",!0),t(s).data("wysiwyg-html-mode",!1),t(s).focus()},g=function(e){s.focus(),t.each(e,function(e,n){/^image\//.test(n.type)?t.when(a(n)).done(function(t){d("insertimage",t),s.trigger("image-inserted")}).fail(function(t){i.fileUploadError("file-reader",t)}):i.fileUploadError("unsupported-file-type",n.type)})},y=function(t,e){m(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,e||"transparent"),h(),t.data(i.selectionMarker,e)},b=function(e,a){e.find(r,l).click(function(){m(),s.focus(),"html"===t(this).data(a.commandRole)?p():d(t(this).data(a.commandRole)),h()}),e.find("[data-toggle=dropdown]").click(m),e.find("input[type=text][data-"+a.commandRole+"]").on("webkitspeechchange change",function(){var e=this.value;this.value="",m(),e&&(s.focus(),d(t(this).data(a.commandRole),e)),h()}).on("focus",function(){var e=t(this);e.data(a.selectionMarker)||(y(e,a.selectionColor),e.focus())}).on("blur",function(){var e=t(this);e.data(a.selectionMarker)&&y(e,!1)}),e.find("input[type=file][data-"+a.commandRole+"]").change(function(){m(),"file"===this.type&&this.files&&this.files.length>0&&g(this.files),h(),this.value=""})},v=function(){s.on("dragenter dragover",!1).on("drop",function(t){var e=t.originalEvent.dataTransfer;t.stopPropagation(),t.preventDefault(),e&&e.files&&e.files.length>0&&g(e.files)})};return i=t.extend(!0,{},t.fn.wysiwyg.defaults,n),r="a[data-"+i.commandRole+"],button[data-"+i.commandRole+"],input[type=button][data-"+i.commandRole+"]",u(i.hotKeys),""!=t(this).attr("placeholder")&&(t(this).addClass("placeholderText"),t(this).html(t(this).attr("placeholder")),t(this).bind("focus",function(){""!=t(this).attr("placeholder")&&t(this).text()==t(this).attr("placeholder")&&(t(this).removeClass("placeholderText"),t(this).html(""))}),t(this).bind("blur",function(){""!=t(this).attr("placeholder")&&""==t(this).text()&&(t(this).addClass("placeholderText"),t(this).html(t(this).attr("placeholder")))})),i.dragAndDropImages&&v(),b(t(i.toolbarSelector),i),s.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){h(),c()}),t(window).bind("touchend",function(t){var e=s.is(t.target)||s.has(t.target).length>0,a=f(),n=a&&a.startContainer===a.endContainer&&a.startOffset===a.endOffset;(!n||e)&&(h(),c())}),this},t.fn.wysiwyg.defaults={hotKeys:{"Ctrl+b meta+b":"bold","Ctrl+i meta+i":"italic","Ctrl+u meta+u":"underline","Ctrl+z":"undo","Ctrl+y meta+y meta+shift+z":"redo","Ctrl+l meta+l":"justifyleft","Ctrl+r meta+r":"justifyright","Ctrl+e meta+e":"justifycenter","Ctrl+j meta+j":"justifyfull","Shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,keypressTimeout:200,fileUploadError:function(t,e){console.log("File upload error",t,e)}}}(window.jQuery);